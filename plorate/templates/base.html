<DOCTYPE html>
<html>
<head>
    <meta charset=utf-8 />
    <title></title>
    <style type="text/css">
            .axis path,
            .axis line {
                fill: none;
                stroke: black;
                shape-rendering: crispEdges;
            }
            
            .axis text {
                font-family: sans-serif;
                font-size: 8px;
            }

            .point {
                fill: black;
                opacity: .3;

            }
            .point-current {
                fill: red;
                opacity: 1;
            }
            path {
                stroke: #c00;
                stroke-width: .5px;
                fill: None;
            }
    </style>
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
    <script type="text/javascript" src="http://d3js.org/d3.v2.js"></script>
    <!--[if IE]>
        <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <script src="http://jashkenas.github.com/coffee-script/extras/coffee-script.js" type="text/javascript" charset="utf-8"></script>
    <script type="text/coffeescript">
        data = {{ data }}
        width = 500
        height = 200

        scatter = (target, data, width, height) ->
            radius = 2
            padding = 50

            x_min = d3.min(data, (i) -> i[0])
            x_max = d3.max(data, (i) -> i[0])
            scale_x = d3.scale.linear()
                .domain([x_min, x_max])
                .range([padding, width - padding])
            axis_x = d3.svg.axis()
                .scale(scale_x)
                .orient("bottom")
                .ticks(5)

            onmouseover = (d, i) -> d3.select(this).attr("class", "point-current")
            onmouseout = (d, i) -> d3.select(this).attr("class", "point")

            y_min = d3.min(data, (i) -> i[1])
            y_max = d3.max(data, (i) -> i[1])
            scale_y = d3.scale.linear()
                .range([padding, height - padding])
                .domain([y_min, y_max])
            axis_y = d3.svg.axis()
                .scale(scale_y)
                .orient("left")
                .ticks(5)

            plot = target
                .append("svg")
                .attr("class", "chart")
                .attr("width", width)
                .attr("height", height)

            plot.selectAll("circle")
                .data(data)
              .enter().append("circle")
                .attr("class", "point")
                .attr("cx", (d, i) -> scale_x(d[0]))
                .attr("cy", (d, i) -> scale_y(d[1]))
                .attr("r", radius)
                .on("mouseover", onmouseover)
                .on("mouseout", onmouseout)

            plot.append("g")
                .attr("class", "axis")
                .attr("transform", "translate(0," + (height - padding) + ")")
                .call(axis_x)
            plot.append("g")
                .attr("class", "axis")
                .attr("transform", "translate(" + (padding) + ", 0)")
                .call(axis_y)


        timeseries = (target, data, width, height) ->
            mini = d3.min((d3.min(i) for i in data))
            maxi = d3.max((d3.max(i) for i in data))
            length = d3.max((i.length for i in data))
            padding = 50

            console.log(mini)
            console.log(maxi)
            console.log(length)

            scale_x = d3.scale.linear()
                .domain([0, length])
                .range([padding, width - padding])
            axis_x = d3.svg.axis()
                .scale(scale_x)
                .orient("bottom")
                .ticks(5)

            scale_y = d3.scale.linear()
                .domain([mini, maxi])
                .range([padding, height - padding])
            axis_y = d3.svg.axis()
                .scale(scale_y)
                .orient("left")
                .ticks(5)

            plot = target
                .append("svg")
                .attr("class", "chart")
                .attr("width", width)
                .attr("height", height)

            console.log(d3.svg.line().x((d,i) -> scale_x(i)).y(scale_y)(data[0]))

            plot.selectAll('path.line')
                .data(data)
              .enter().append("svg:path")
                .attr("d", d3.svg.line()
                            .x((d,i) -> scale_x(i))
                            .y(scale_y))

            plot.append("g")
                .attr("class", "axis")
                .attr("transform", "translate(" + (padding) + ", 0)")
                .call(axis_y)

            plot.append("g")
                .attr("class", "axis")
                .attr("transform", "translate(0," + (height - padding) + ")")
                .call(axis_x)

        {% block plot_code %}
        {% endblock %}

      </script>

    {% block htmlhead %}
    {% endblock %}
    

</head>
<body>
</body>
</html>
